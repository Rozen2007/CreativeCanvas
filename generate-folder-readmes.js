const fs = require('fs');
const path = require('path');

const ROOT = './'

const isUnixHiddenPath = (path) => {
  return !(/(^|\/)\.[^\/\.]/g).test(path);
};

(() => {
  fs.readdir(ROOT, function (err, files) {
    if (err) throw new Error(err);

    files.filter(isUnixHiddenPath).forEach(name => {
      // skip these folders
      if (name.match(/thumbnails|src/)) return false;

      let filePath = path.join(ROOT, name);
      let stat = fs.statSync(filePath);
      if (stat.isDirectory()) {
        // read nested files under filePath
        fs.readdir(filePath, (err, subFiles) => {
          if (err) throw new Error(err);

          // if already readme.md (case-sensitive) exists then skip
          if (!subFiles.includes('readme.md')) {
            createReadmes(filePath);
          }
        })
      }
    });
  });


  function createReadmes(filePath) {
    let targetFile = path.join(filePath, 'README.md');

    const output = [
      '<!-- This file is auto generated do not edit this file directly -->',
      '<!-- Edit the generate-folder-readmes.js file instead -->',
      `# ${filePath}`,
      `\n[Live Demo](https://github.com/Rozen2007/CreativeCanvas/${filePath})`,
      `\n-------\n`,
      `Made with :heart:`,
    ]

    fs.writeFileSync(targetFile, output.join('\n'));
  }

})()
